
{
  "entities": {
    "Tournament": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Tournament",
      "type": "object",
      "description": "Represents a Texas Hold'em poker tournament.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the tournament."
        },
        "name": {
          "type": "string",
          "description": "Name of the tournament."
        },
        "buyIn": {
          "type": "number",
          "description": "The buy-in amount for the tournament."
        },
        "startTime": {
          "type": "string",
          "description": "The start time of the tournament.",
          "format": "date-time"
        },
        "currentRoundId": {
          "type": "string",
          "description": "Reference to the current Round. (Relationship: Tournament 1:1 Round)"
        },
        "prizePool": {
          "type": "number",
          "description": "The total prize pool for the tournament."
        },
        "payoutStructureId": {
          "type": "string",
          "description": "Reference to the payout structure. (Relationship: Tournament 1:1 PayoutStructure)"
        }
      },
      "required": [
        "id",
        "name",
        "buyIn",
        "startTime",
        "payoutStructureId"
      ]
    },
    "Round": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Round",
      "type": "object",
      "description": "Represents a round in the poker tournament with blind levels and antes.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the round."
        },
        "tournamentId": {
          "type": "string",
          "description": "Reference to the Tournament. (Relationship: Tournament 1:N Round)"
        },
        "roundNumber": {
          "type": "number",
          "description": "The ordinal number of this round within the tournament."
        },
        "smallBlind": {
          "type": "number",
          "description": "The small blind amount for this round."
        },
        "bigBlind": {
          "type": "number",
          "description": "The big blind amount for this round."
        },
        "ante": {
          "type": "number",
          "description": "The ante amount for this round."
        },
        "duration": {
          "type": "number",
          "description": "Duration of the round in minutes."
        }
      },
      "required": [
        "id",
        "tournamentId",
        "roundNumber",
        "smallBlind",
        "bigBlind",
        "ante",
        "duration"
      ]
    },
    "PayoutStructure": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PayoutStructure",
      "type": "object",
      "description": "Defines how the prize pool is distributed among the winners.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the payout structure."
        },
        "tournamentId": {
          "type": "string",
          "description": "Reference to the Tournament. (Relationship: Tournament 1:1 PayoutStructure)"
        },
        "firstPlacePercentage": {
          "type": "number",
          "description": "Percentage of the prize pool awarded to the first-place winner."
        }
      },
      "required": [
        "id",
        "firstPlacePercentage"
      ]
    },
    "CashGame": {
      "title": "CashGame",
      "type": "object",
      "description": "Represents a live cash game session.",
      "properties": {
        "id": { "type": "string" },
        "ownerId": { "type": "string" },
        "name": { "type": "string" },
        "chips": { "type": "array", "items": { "$ref": "#/entities/CashGameChip" } },
        "players": { "type": "array", "items": { "$ref": "#/entities/CashGamePlayer" } },
        "cashedOutPlayers": { "type": "array", "items": { "$ref": "#/entities/CashedOutPlayer" } },
        "requests": { "type": "array", "items": { "$ref": "#/entities/JoinRequest" } },
        "positionsSet": { "type": "boolean" },
        "dealerId": { "type": ["string", "null"] },
        "createdAt": { "type": "string", "format": "date-time" },
        "handState": { "$ref": "#/entities/HandState" }
      }
    },
    "HandState": {
      "title": "HandState",
      "type": "object",
      "description": "Represents the state of a single hand in a cash game.",
      "properties": {
        "phase": { "type": "string", "enum": ["PRE_DEAL", "PRE_FLOP", "FLOP", "TURN", "RIVER", "SHOWDOWN"] },
        "pot": { "type": "number" },
        "communityCards": { "type": "array", "items": { "$ref": "#/entities/Card" } },
        "activePlayerId": { "type": ["string", "null"] },
        "lastRaise": { "type": "number" },
        "smallBlindAmount": { "type": "number" },
        "bigBlindAmount": { "type": "number" },
        "smallBlindPlayerId": { "type": ["string", "null"] },
        "bigBlindPlayerId": { "type": ["string", "null"] },
        "players": { "type": "array", "items": { "$ref": "#/entities/PlayerHandState" } }
      }
    },
    "Card": {
      "title": "Card",
      "type": "object",
      "properties": {
        "suit": { "type": "string" },
        "rank": { "type": "string" }
      }
    },
    "PlayerHandState": {
      "title": "PlayerHandState",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "seat": { "type": "number" },
        "stack": { "type": "number" },
        "bet": { "type": "number" },
        "card1": { "$ref": "#/entities/Card" },
        "card2": { "$ref": "#/entities/Card" },
        "hasActed": { "type": "boolean" },
        "isFolded": { "type": "boolean" },
        "isAllIn": { "type": "boolean" }
      }
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/tournaments/{tournamentId}",
        "definition": {
          "entityName": "Tournament",
          "schema": {
            "$ref": "#/backend/entities/Tournament"
          },
          "description": "Stores tournament details. Includes denormalized fields if authorization depends on tournament attributes.",
          "params": [
            {
              "name": "tournamentId",
              "description": "Unique identifier for the tournament."
            }
          ]
        }
      },
      {
        "path": "/tournaments/{tournamentId}/rounds/{roundId}",
        "definition": {
          "entityName": "Round",
          "schema": {
            "$ref": "#/backend/entities/Round"
          },
          "description": "Stores round details for a specific tournament.",
          "params": [
            {
              "name": "tournamentId",
              "description": "The ID of the tournament to which this round belongs."
            },
            {
              "name": "roundId",
              "description": "Unique identifier for the round."
            }
          ]
        }
      },
      {
        "path": "/tournaments/{tournamentId}/payoutStructures/{payoutStructureId}",
        "definition": {
          "entityName": "PayoutStructure",
          "schema": {
            "$ref": "#/backend/entities/PayoutStructure"
          },
          "description": "Stores payout structure for a specific tournament.",
          "params": [
            {
              "name": "tournamentId",
              "description": "The ID of the tournament to which this payout structure belongs."
            },
            {
              "name": "payoutStructureId",
              "description": "Unique identifier for the payout structure."
            }
          ]
        }
      },
       {
        "path": "/cashGames/{gameId}",
        "definition": {
          "entityName": "CashGame",
          "schema": {
            "$ref": "#/entities/CashGame"
          },
          "description": "Stores details for a cash game session."
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to manage Texas Hold'em poker tournaments and cash games, focusing on configurability, real-time updates, and a clear separation of concerns. The structure emphasizes authorization independence, clarity, and performance.\n\n**Authorization Independence:**  Authorization is path-based. There is no reliance on `get()` calls within security rules.\n\n**Structure:**\n\n*   **/tournaments/{tournamentId}:** Stores tournament-level information.\n*   **/cashGames/{gameId}:** Stores cash game information, including an embedded `handState` object to manage the state of the current hand in real-time.\n\n**Denormalization:**\n\n*   The `handState` object within `/cashGames/{gameId}` is a form of denormalization. It keeps all data related to the active hand in one document, allowing for efficient real-time updates and reads from a single document listener, which is critical for the dealer mode functionality. This avoids complex queries across multiple collections during a fast-paced game."
  }
}
