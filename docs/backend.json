{
  "entities": {
    "Tournament": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Tournament",
      "type": "object",
      "description": "Represents a Texas Hold'em poker tournament.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the tournament."
        },
        "name": {
          "type": "string",
          "description": "Name of the tournament."
        },
        "buyIn": {
          "type": "number",
          "description": "The buy-in amount for the tournament."
        },
        "startTime": {
          "type": "string",
          "description": "The start time of the tournament.",
          "format": "date-time"
        },
        "currentRoundId": {
          "type": "string",
          "description": "Reference to the current Round. (Relationship: Tournament 1:1 Round)"
        },
        "prizePool": {
          "type": "number",
          "description": "The total prize pool for the tournament."
        },
        "payoutStructureId": {
          "type": "string",
          "description": "Reference to the payout structure. (Relationship: Tournament 1:1 PayoutStructure)"
        }
      },
      "required": [
        "id",
        "name",
        "buyIn",
        "startTime",
        "payoutStructureId"
      ]
    },
    "Round": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Round",
      "type": "object",
      "description": "Represents a round in the poker tournament with blind levels and antes.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the round."
        },
        "tournamentId": {
          "type": "string",
          "description": "Reference to the Tournament. (Relationship: Tournament 1:N Round)"
        },
        "roundNumber": {
          "type": "number",
          "description": "The ordinal number of this round within the tournament."
        },
        "smallBlind": {
          "type": "number",
          "description": "The small blind amount for this round."
        },
        "bigBlind": {
          "type": "number",
          "description": "The big blind amount for this round."
        },
        "ante": {
          "type": "number",
          "description": "The ante amount for this round."
        },
        "duration": {
          "type": "number",
          "description": "Duration of the round in minutes."
        }
      },
      "required": [
        "id",
        "tournamentId",
        "roundNumber",
        "smallBlind",
        "bigBlind",
        "ante",
        "duration"
      ]
    },
    "PayoutStructure": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PayoutStructure",
      "type": "object",
      "description": "Defines how the prize pool is distributed among the winners.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the payout structure."
        },
        "tournamentId": {
          "type": "string",
          "description": "Reference to the Tournament. (Relationship: Tournament 1:1 PayoutStructure)"
        },
        "firstPlacePercentage": {
          "type": "number",
          "description": "Percentage of the prize pool awarded to the first-place winner."
        }
      },
      "required": [
        "id",
        "firstPlacePercentage"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/tournaments/{tournamentId}",
        "definition": {
          "entityName": "Tournament",
          "schema": {
            "$ref": "#/backend/entities/Tournament"
          },
          "description": "Stores tournament details. Includes denormalized fields if authorization depends on tournament attributes.",
          "params": [
            {
              "name": "tournamentId",
              "description": "Unique identifier for the tournament."
            }
          ]
        }
      },
      {
        "path": "/tournaments/{tournamentId}/rounds/{roundId}",
        "definition": {
          "entityName": "Round",
          "schema": {
            "$ref": "#/backend/entities/Round"
          },
          "description": "Stores round details for a specific tournament.",
          "params": [
            {
              "name": "tournamentId",
              "description": "The ID of the tournament to which this round belongs."
            },
            {
              "name": "roundId",
              "description": "Unique identifier for the round."
            }
          ]
        }
      },
      {
        "path": "/tournaments/{tournamentId}/payoutStructures/{payoutStructureId}",
        "definition": {
          "entityName": "PayoutStructure",
          "schema": {
            "$ref": "#/backend/entities/PayoutStructure"
          },
          "description": "Stores payout structure for a specific tournament.",
          "params": [
            {
              "name": "tournamentId",
              "description": "The ID of the tournament to which this payout structure belongs."
            },
            {
              "name": "payoutStructureId",
              "description": "Unique identifier for the payout structure."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to manage Texas Hold'em poker tournaments, focusing on configurability, real-time updates, and a clear separation of concerns. The structure emphasizes authorization independence, clarity, and performance.\n\n**Authorization Independence:**  Authorization is path-based. There is no reliance on `get()` calls within security rules.\n\n**Structure:**\n\n*   **/tournaments/{tournamentId}:** Stores tournament-level information (name, buy-in, start time, current round).\n*   **/tournaments/{tournamentId}/rounds/{roundId}:** Stores round details (blind levels, antes, duration).\n*   **/tournaments/{tournamentId}/payoutStructures/{payoutStructureId}:** Stores the payout structure (e.g., percentage for the winner).\n\n**QAPs Support:**\n\n*   The structure naturally supports secure `list` operations (QAPs) due to the flat, non-hierarchical authorization model within each collection. Listing tournaments is secure; listing rounds associated with a tournament is secure because access to the `rounds` subcollection is controlled via the `tournamentId` and the assumption that only authenticated users can view the tournament details, and therefore associated rounds.\n\n**Denormalization:**\n\n*   While the data structure doesn't require explicit denormalization for authorization, the `tournamentId` field in the `rounds` and `payoutStructures` subcollections act as a form of denormalization, enabling efficient querying and data retrieval without needing to traverse parent documents.\n\n**Additional Considerations:**\n\n*   **Timestamps:** Consider adding `createdAt` and `updatedAt` timestamp fields to each document for auditing and data management.\n*   **Status:** A `status` field (e.g., `DRAFT`, `ACTIVE`, `COMPLETED`) in the `tournaments` collection would facilitate state management.\n*   **Indexes:** Define composite indexes for common queries (e.g., tournaments by start time, rounds by round number).\n\nThis structure facilitates atomic operations within each collection (e.g., creating a round) and simplifies security rules by focusing on path-based access control. It is readily scalable and debuggable due to its clarity and independence from complex hierarchical dependencies."
  }
}